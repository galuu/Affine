\documentclass[a4paper,12pt]{article}
\usepackage[unicode,verbose]{hyperref}
\usepackage{amsmath,amssymb,amsthm} \usepackage{pb-diagram}
\usepackage{ucs}
%\usepackage[utf8x]{inputenc}
%\usepackage[russian]{babel}
\usepackage{cmap}
\usepackage[pdftex]{graphicx}
\pagestyle{plain}
\theoremstyle{definition} \newtheorem{Def}{Definition}
%\usepackage{verbatim} 
\newenvironment{comment}
{\par\noindent{\bf TODO}\\}
{\\\hfill$\scriptstyle\blacksquare$\par}

\begin{document}
\title{\textbf{{\Large {Recurrent relation for branching coefficients of affine Lie algebras}}}}
\author{Vladimir Lyakhovsky\\
Theoretical Department, SPb State University,\\
198904, Sankt-Petersburg, Russia \\
e-mail:lyakh1507@nm.ru \\
[5mm] Anton Nazarov \\
%EndAName
Theoretical Department, SPb State University,\\
198904, Sankt-Petersburg, Russia \\
e-mail:antonnaz@gmail.com\\
}
\maketitle

\begin{abstract}
  We present the recurrent relation for the branching coefficients of affine Lie algebras. Then we describe the algorithm for the decomposition of  integrable highest weight modules
of a simple Lie algebra with respect to its reductive subalgebra which is based upon this recurrent relation and present some examples. Also we discuss the appearance of branching coefficients in the physical models.
\end{abstract}


\section{Introduction}
\label{sec:introduction}

\begin{comment}
  Write here about the problem and possible applications in physics.
\end{comment}

The paper is organised as follows. In the next subsection of the introduction we fix the notation used throughout the paper. Then in section \ref{sec:recurr-form-branch} we derive the central recurrent formula for the anomalous branching coefficients and describe the algorithm for the decomposition integrable highest weight modules of algebra $\mathfrak{g}$ to the modules of reductive subalgebra $\mathfrak{a}$ \ref{sec:algorithm}. In the next section \ref{sec:examples} we present several examples and discuss some applications in the physical models \ref{sec:phys-appl}. We conclude the paper with the review of results and the discussion of possible future developments \ref{sec:conclusion}.

\subsection{Notation}
\label{sec:notation}

Consider the affine Lie algebras $\frak{g}$ and $\frak{a}$ with the
underlying finite-dimensional subalgebras $\overset{\circ }{\frak{g}}$ and $%
\overset{\circ }{\frak{a}}$ and an injection $\frak{a}\longrightarrow \frak{g%
}$ such that $\frak{a}$ is a reductive subalgebra $\frak{a\subset g}$ with
correlated root spaces: $\frak{h}_{\frak{a}}^{\ast }\subset \frak{h}_{\frak{g%
}}^{\ast }$ and $\frak{h}_{\overset{\circ }{\frak{a}}}^{\ast }\subset \frak{h%
}_{\overset{\circ }{\frak{g}}}^{\ast }$\ .

We use the following notations adopted from the paper \cite{ilyin812pbc}.

$L^{\mu }$\ $\left( L_{\frak{a}}^{\nu }\right) $\ -- the integrable module
of $\frak{g}$ with the highest weight $\mu $\ ; (resp. integrable $\frak{a}$
-module with the highest weight $\nu $ );

$r$ , $\left( r_{\frak{a}}\right) $ -- the rank of the algebra $\frak{g}$ $%
\left( \text{resp. }\frak{a}\right) $ ;

$\Delta $ $\left( \Delta _{\frak{a}}\right) $-- the root system; $\Delta
^{+} $ $\left( \text{resp. }\Delta _{\frak{a}}^{+}\right) $-- the positive
root system (of $\frak{g}$ and $\frak{a}$ respectively);

$\mathrm{mult}\left( \alpha \right) $ $\left( \mathrm{mult}_{\frak{a}}\left(
\alpha \right) \right) $ -- the multiplicity of the root $\alpha$ in $\Delta 
$ (resp. in $\left( \Delta _{\frak{a}}\right) $);

$\overset{\circ }{\Delta }$ , $\left( \overset{\circ }{\Delta _{\frak{a}}}%
\right) $ -- the finite root system of the subalgebra $\overset{\circ }{%
\frak{g}}$ (resp. $\overset{\circ }{\frak{a}}$);

$\mathcal{N}^{\mu }$ , $\left( \mathcal{N}_{\frak{a}}^{\nu }\right) $ -- the
weight diagram of $L^{\mu }$ $\left( \text{resp. }L_{\frak{a}}^{\nu }\right) 
$ ;

$W$ , $\left( W_{\frak{a}}\right) $-- the corresponding Weyl group;

$C$ , $\left( C_{\frak{a}}\right) $-- the fundamental Weyl chamber;

$\rho $\ , $\left( \rho _{\frak{a}}\right) $\ -- the Weyl vector;

$\epsilon \left( w\right) :=\det \left( w\right) $ ;

$\alpha _{i}$ , $\left( \alpha _{\left( \frak{a}\right) j}\right) $ -- the $i
$-th (resp. $j$-th) basic root for $\frak{g}$ $\left( \text{resp. }\frak{a}%
\right) $; $i=0,\ldots ,r$ ,\ \ $\left( j=0,\ldots ,r_{\frak{a}}\right) $;

$\delta $ -- the imaginary root of $\frak{g}$ (and of $\frak{a}$ if any);

$\alpha _{i}^{\vee }$ , $\left( \alpha _{\left( \frak{a}\right) j}^{\vee
}\right) $-- the basic coroot for $\frak{g}$ $\left( \text{resp. }\frak{a}%
\right) $ , $i=0,\ldots ,r$ ;\ \ $\left( j=0,\ldots ,r_{\frak{a}}\right) $;

$\overset{\circ }{\xi }$ , $\overset{\circ }{\xi _{\left( \frak{a}\right) }}$
-- the finite (classical) part of the weight $\xi \in P$ , $\left( \text{%
resp. }\xi _{\left( \frak{a}\right) }\in P_{\frak{a}}\right) $\ ;

$\lambda =\left( \overset{\circ }{\lambda };k;n\right) $ -- the
decomposition of an affine weight indicating the finite part $\overset{\circ 
}{\lambda }$, level $k$ and grade $n$\ .

$P$ $\left( \text{resp. } P_{\frak{a}}\right) $ \ -- the weight lattice;

$M \left( \text{resp. }M_{\frak{a}}\right) :=$

\noindent $=\left\{ 
\begin{array}{c}
\sum_{i=1}^{r}\mathbf{Z}\alpha _{i}^{\vee }\text{ }\left( \text{resp. }%
\sum_{i=1}^{r}\mathbf{Z}\alpha _{\left( \frak{a}\right) i}^{\vee }\right) 
\text{for untwisted algebras or }A_{2r}^{\left( 2\right) }, \\ 
\sum_{i=1}^{r}\mathbf{Z}\alpha _{i}\text{ }\left( \text{resp. }\sum_{i=1}^{r}%
\mathbf{Z}\alpha _{\left( \frak{a}\right) i}\right) \text{for }A_{r}^{\left(
u\geq 2\right) }\text{ and }A\neq A_{2r}^{\left( 2\right) },
\end{array}
\right\} ;$

$\mathcal{E}$\ , $\left( \mathcal{E}_{\frak{a}}\right) $-- the group algebra
of the group $P$ (resp. $P_{\frak{a}} $);

$\Theta _{\lambda }:=e^{-\frac{\left| \lambda \right| ^{2}}{2k}\delta
}\sum\limits_{\alpha \in M}e^{t_{\alpha }\circ \lambda }$ -- the classical
theta-function;

$\Theta _{\left( \frak{a}\right) \nu }:=e^{-\frac{\left| \nu \right| ^{2}}{%
2k_{\frak{a}}}\delta }\sum\limits_{\beta \in M_{\frak{a}}}e^{t_{\beta }\circ
\nu }$;\newline
notice that when the injection is considered the level $k_{\frak{a}}$ must
be correlated with the corresponding rescaling of roots;

$A_{\lambda }:=\sum\limits_{s\in \overset{\circ }{W}}\epsilon (s)\Theta
_{s\circ \lambda }$ $\left( \text{resp. }A_{\left( \frak{a}\right) \nu
}:=\sum\limits_{s\in \overset{\circ }{W_{\frak{a}}}}\epsilon (s)\Theta
_{\left( \frak{a}\right) s\circ \nu }\right) $;

$\Psi ^{\left( \mu \right) }:=e^{\frac{\left| \mu +\rho \right| ^{2}}{2k}%
\delta \ -\ \rho }A_{\mu +\rho }=e^{\frac{\left| \mu +\rho \right| ^{2}}{2k}%
\delta \ -\ \rho }\sum\limits_{s\in \overset{\circ }{W}}\epsilon (s)\Theta
_{s\circ \left( \mu +\rho \right) }=$

\noindent $=\sum\limits_{w\in W}\epsilon (w)e^{w\circ (\mu +\rho )-\rho }$
-- the singular weight element for the $\frak{g}$-module $L^{\mu }$;

$\Psi _{\left( \frak{a}\right) }^{\left( \nu \right) }:=e^{\frac{\left| \nu
+\rho _{_{\frak{a}}}\right| ^{2}}{2k_{\frak{a}}}\delta \ -\ \rho _{_{\frak{a}%
}}}A_{\left( \frak{a}\right) \nu +\rho _{_{\frak{a}}}}=e^{\frac{\left| \nu
+\rho _{_{\frak{a}}}\right| ^{2}}{2k_{\frak{a}}}\delta \ -\ \rho _{_{\frak{a}%
}}}\sum\limits_{s\in \overset{\circ }{W_{\frak{a}}}}\epsilon (s)\Theta
_{\left( \frak{a}\right) s\circ \left( \nu +\rho _{_{\frak{a}}}\right) }=$

\noindent $=\sum\limits_{w\in W_{\frak{a}}}\epsilon (w)e^{w\circ (\nu +\rho
_{_{\frak{a}}})-\rho _{_{\frak{a}}}}$ -- the corresponding singular weight
element for the $\frak{a}$-module $L_{\frak{a}}^{\nu }$;

$\widehat{\Psi ^{\left( \mu \right) }}$ $\left( \widehat{\Psi _{\left( \frak{%
a}\right) }^{\left( \nu \right) }}\right) $ -- the set of singular weights $%
\xi \in P$ $\left( \text{resp. }\in P_{\frak{a}}\right) $ for the module $%
L^{\mu }$ $\left( \text{resp. }L_{\frak{a}}^{\nu }\right) $ with the
coordinates $\left( \overset{\circ }{\xi },k,n,\epsilon \left( w\left( \xi
\right) \right) \right) \mid _{\xi =w\left( \xi \right) \circ (\mu +\rho
)-\rho },$ (resp. $\left( \overset{\circ }{\xi },k,n,\epsilon \left(
w_{a}\left( \xi \right) \right) \right) \mid _{\xi =w_{a}\left( \xi \right)
\circ (\nu +\rho _{a})-\rho _{a}}$ ), (this set is similar to $P_{\mathrm{%
nice}}^{\prime }\left( \mu \right) $ in \cite{wakimoto2001idl})

$m_{\xi }^{\left( \mu \right) }$ , $\left( m_{\xi }^{\left( \nu \right)
}\right) $ -- the multiplicity of the weight $\xi \in P$ \ $\left( \text{%
resp. }\in P_{\frak{a}}\right) $ in the module $L^{\mu }$ , (resp. $\xi \in
L_{\frak{a}}^{\nu } $);

$ch\left( L^{\mu }\right) $ $\left( \text{resp. }ch\left( L_{\frak{a}}^{\nu
}\right) \right) $-- the formal character of $L^{\mu }$ $\left( \text{resp. }%
L_{\frak{a}}^{\nu }\right) $;

$ch\left( L^{\mu }\right) =\frac{\sum_{w\in W}\epsilon (w)e^{w\circ (\mu
+\rho )-\rho }}{\prod_{\alpha \in \Delta ^{+}}\left( 1-e^{-\alpha }\right) ^{%
\mathrm{{mult}\left( \alpha \right) }}}=\frac{\Psi ^{\left( \mu \right) }}{%
\Psi ^{\left( 0\right) }}$ -- the Weyl-Kac formula.

$R:=\prod_{\alpha \in \Delta ^{+}}\left( 1-e^{-\alpha }\right) ^{\mathrm{{%
mult}\left( \alpha \right) }}=\Psi ^{\left( 0\right) }\quad $

\noindent $\left( \text{resp. }R_{\frak{a}}:=\prod_{\alpha \in \Delta _{%
\frak{a}}^{+}}\left( 1-e^{-\alpha }\right) ^{\mathrm{mult}_{\frak{a}}\mathrm{%
\left( \alpha \right) }}=\Psi _{\frak{a}}^{\left( 0\right) }\right) $-- the
denominator.

Character reduction
\begin{equation}
  \label{eq:19}
  L_{\frak{g}\downarrow \frak{a}}^{\mu }=\bigoplus\limits_{\nu \in P_{\frak{a}%
    }^{+}}b_{\nu }^{\left( \mu \right) }L_{\frak{a}}^{\nu }\quad
  \Longrightarrow\quad
  \pi_{\mathfrak{a}}(ch L^{\mu}_{\mathfrak{g}})=\sum_{\nu\in P^{+}_{\mathfrak{a}}}b^{(\mu)}_{\nu} ch L^{\nu}_{\mathfrak{a}}
\end{equation}
Numbers $b^{(\mu)}_{\nu}$ are called branching coefficients.

The anomalous branching coefficients $k_{\lambda}$ are defined as follows
\begin{equation}
  \label{eq:21}
  \sum_{\nu \in P_{\frak{a}}}b_{\nu }^{\left( \mu \right) }\Psi _{\left( \frak{%
        a}\right) }^{\left( \nu \right) }=\sum_{\lambda \in P_{\frak{a}}}k_{\lambda
  }^{\left( \mu \right) }e^{\lambda } 
\end{equation}

It is important to mention that
\begin{equation}
  \label{eq:20}
  b^{(\mu)}_{\nu}=k^{(\mu)}_{\nu} \; \mbox{for} \; \nu\in C_{\mathfrak{a}}
\end{equation}

\section{Recurrent formula for branching coefficients}
\label{sec:recurr-form-branch}

Here we present the final recurrent relation for the anomalous branching coefficients \eqref{eq:21}. 
\begin{equation}
k_{\xi }^{\left( \mu \right) }=-\frac{1}{s\left( \gamma _{0}\right) }\left(
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) dim\left(L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) \delta_{\xi,\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho)}+
\sum_{\gamma \in
\Gamma _{\frak{a}\subset \frak{g}}}s\left( \gamma +\gamma _{0}\right) k_{\xi
+\gamma }^{\left( \mu \right) }\right)
\end{equation}
The proof of the formula and definitions of $\mathfrak{a}_{\bot},\; W_{\bot},\; s(\gamma),\; \Gamma_{\mathfrak{a}\subset \mathfrak{g}}$ are in the following subsection.

In the next section we describe the algorithm for the computation of branching coefficients based upon this formula and then present some example and discuss physical meaning.

\subsection{Proof of the recurrent formula}
\label{sec:proof}

The decomposition of the representation of the algebra to the representations of the subalgebra can be symbolically written using formal characters and projection operator:
\begin{equation}
  \label{eq:3}
  L_{\frak{g}\downarrow \frak{a}}^{\mu }=\bigoplus\limits_{\nu \in P_{\frak{a}%
    }^{+}}b_{\nu }^{\left( \mu \right) }L_{\frak{a}}^{\nu }\quad
  \Longrightarrow\quad
  \pi_{\mathfrak{a}}(ch L^{\mu}_{\mathfrak{g}})=\sum_{\nu\in P^{+}_{\mathfrak{a}}}b^{(\mu)}_{\nu} ch L^{\nu}_{\mathfrak{a}}
\end{equation}
Now using the Weyl-Kac formula for the character of the module
\begin{equation}
  \label{eq:2}
  ch L^{\mu}=\frac{\sum_{\omega\in W} \epsilon(\omega) e^{\omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta^{+}}(1-e^{-\alpha})^{mult(\alpha)}}
\end{equation}
we obtain the equality
\begin{equation}
  \label{eq:4}
  \pi_{\mathfrak{a}}\left(\frac{\sum_{\omega\in W} \epsilon(\omega) e^{\omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta^{+}}(1-e^{-\alpha})^{mult(\alpha)}}\right) = 
  \sum_{\nu\in P^{+}_{\mathfrak{a}}}b^{(\mu)}_{\nu}
  \frac{\sum_{\omega\in W_{\mathfrak{a}}}\epsilon(\omega)e^{\omega(\nu+\rho_{\mathfrak{a}})-\rho_{\mathfrak{a}}}}{\prod_{\beta\in \Delta_{\mathfrak{a}}^{+}}(1-e^{-\beta})^{mult_{\mathfrak{a}}(\beta)}}
\end{equation}

It is important to mention that the projection of some of the positive roots of the algebra $\mathfrak{g}$ can be equal to zero. These roots are orthogonal to the root space of the subalgebra $\mathfrak{a}$ embedded into the root space of the algebra $\mathfrak{g}$. Let's denote the subset of these roots by $\Delta_{\bot}=\left\{\alpha\in\Delta_{\mathfrak{g}}^{+}:\forall \beta\in \Delta_{\mathfrak{a}}^{+},\; \alpha\bot\beta \right\}$.

Now we should notice that if the set $\Delta_{\bot}$ is non-empty than Weyl reflections which correspond to the positive roots of $\Delta_{\bot}$ generate a subgroup $W_{\bot}$ of Weyl group $W$. 

Let's denote the subalgebra with the root space spanned over the set $\Delta_{\bot}$ by $\mathfrak{a}_{\bot}$.

Now we should discuss when the subset $\Delta_{\bot}$ is non-empty and the subgroup $W_{\bot}$ and subalgebra $\mathfrak{a}_{\bot}$ are non-trivial.

If $\mathfrak{a}$ is a maximal regular subalgebra of $\mathfrak{g}$ then rank of $\mathfrak{a}$ is equal to the rank of $\mathfrak{g}$ and it is clear that $\Delta_{\bot}$ is empty.
Then the modules $L_{\mathfrak{a}_{\bot}}$ are trivial, the dimensions are equal to 1 and we get the formula (11) from the paper \cite{ilyin812pbc}.

Non-maximal regular embedding of $\mathfrak{a}$ into $\mathfrak{g}$ can be obtained through the chain of maximal embeddings $\mathfrak{a}\subset \mathfrak{p}_1\subset \mathfrak{p}_2\subset\dots \subset \mathfrak{g}$. Also the maximal regular embeddings are constructed by the exclusion of one or two roots from the extended Dynkin diagram of the algebra. Since this process can give us non-connected Dynkin diagrams we can see which roots are orthogonal to the root space of non-maximal regular subalgebra $\mathfrak{a}$. 

Consider for example regular embedding of $A_1\subset B_2$ ($su(2)\subset so(5)$). 

The extended Dynkin diagram of $B_2$ 
\begin{figure}[ph]
  \centering
  \includegraphics[width=40mm]{B2_A1_diagram.pdf}
  \caption{Extended Dynkin diagram of $B_2$ and embedding of $A_1$}
  \label{fig:B2Dynkin}
\end{figure}
We then drop central node and get the embedding $A_1\otimes A_1\subset B_2$. Then $\mathfrak{a}=A_1$ and $\mathfrak{a}_{\bot}=A_1$.
\begin{comment}
  Consider special embeddings
\end{comment}

Now we can multiply the equation (\ref{eq:4}) by the term
\begin{equation}
  \label{eq:5}
  \pi_{\mathfrak{a}}\left(\prod_{\alpha\in \Delta^{+}\setminus \Delta_{\bot}}(1-e^{-\alpha})^{mult_{\mathfrak{g}}(\alpha)} \right)
\end{equation}
This term is non-zero. 

Also we can see that 
\begin{equation}
  \label{eq:6}
  \pi_{\mathfrak{a}} (P) \pi_{\mathfrak{a}}(1-e^{-\alpha})=\pi_{\mathfrak{a}}\left(P\cdot (1-e^{-\alpha})\right)
\end{equation}
The equation (\ref{eq:4}) takes the form
\begin{multline}
  \label{eq:7}
  \pi_{\mathfrak{a}}\left(\frac{\sum_{\omega\in W} \epsilon(\omega) e^{\omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta_{\bot}}(1-e^{-\alpha})^{mult(\alpha)}}\right) = \\
  \pi_{\mathfrak{a}}\left(\prod_{\alpha\in \Delta^{+}\setminus \Delta_{\bot}}(1-e^{-\alpha})^{mult_{\mathfrak{g}}(\alpha)} \right)\sum_{\nu\in P^{+}_{\mathfrak{a}}}b^{(\mu)}_{\nu}
  \frac{\sum_{\omega\in W_{\mathfrak{a}}}\epsilon(\omega)e^{\omega(\nu+\rho_{\mathfrak{a}})-\rho_{\mathfrak{a}}}}{\prod_{\beta\in \Delta_{\mathfrak{a}}^{+}}(1-e^{-\beta})^{mult_{\mathfrak{a}}(\beta)}}
\end{multline}
The right-hand side of this equation can be reorganised as in the paper \cite{ilyin812pbc}. We introduce anomalous branching coefficients $k_{\lambda}$.
\begin{equation}
  \label{eq:10}
  \sum_{\nu \in P_{\frak{a}}}b_{\nu }^{\left( \mu \right) }\Psi _{\left( \frak{%
        a}\right) }^{\left( \nu \right) }=\sum_{\lambda \in P_{\frak{a}}}k_{\lambda
  }^{\left( \mu \right) }e^{\lambda } 
\end{equation}
Also we extract the common denominator of  the right-hand side of the equation (\ref{eq:7})
\begin{multline}
  \label{eq:12}
  \pi_{\mathfrak{a}}\left(\frac{\sum_{\omega\in W} \epsilon(\omega) e^{\omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta_{\bot}}(1-e^{-\alpha})^{mult(\alpha)}}\right) = \\
  \frac{\pi_{\mathfrak{a}}\left(\prod_{\alpha\in \Delta^{+}\setminus \Delta_{\bot}}(1-e^{-\alpha})^{mult_{\mathfrak{g}}(\alpha)} \right)}
  {  \prod_{\beta\in \Delta_{\mathfrak{a}}^{+}}(1-e^{-\beta})^{mult_{\mathfrak{a}}(\beta)}}
\sum_{\lambda \in P_{\frak{a}}}k_{\lambda
}^{\left( \mu \right) }e^{\lambda } 
\end{multline}


If the set $\Delta_{\bot}$ is non-empty then Weyl reflections corresponding to the positive roots of $\Delta_{\bot}$ generate a subgroup $W_{\bot}$ of Weyl group $W$. 

We have denoted the subalgebra with the root space spanned over the set $\Delta_{\bot}$ by $\mathfrak{a}_{\bot}$.

Then we can reorganise the summation on the left-hand side of the equation (\ref{eq:12}) in the following way
\begin{multline}
  \label{eq:13}
 \pi_{\mathfrak{a}}\left(\frac{\sum_{\omega\in W} \epsilon(\omega) e^{\omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta_{\bot}}(1-e^{-\alpha})^{mult(\alpha)}}\right) = \\
 \pi_{\mathfrak{a}}\left(\sum_{\omega\in W/W_{\bot}} \epsilon(\omega) \frac{\sum_{\nu\in W_{\bot}}\epsilon(\nu) e^{\nu \cdot \omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta_{\bot}}(1-e^{-\alpha})^{mult(\alpha)}}\right) 
\end{multline}


Then we see that
\begin{multline}
  \label{eq:14}
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) \frac{\sum_{\nu\in W_{\bot}}\epsilon(\nu) e^{\nu \cdot \omega(\mu+\rho)-\rho}}{\prod_{\alpha\in\Delta_{\bot}}(1-e^{-\alpha})^{mult(\alpha)}} =\\
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) e^{-\rho} \frac{e^{\rho_{\mathfrak{a}_{\bot}} }\sum_{\nu\in W_{\bot}}\epsilon(\nu) e^{\nu \cdot (\omega(\mu+\rho)-\rho_{\mathfrak{a}_{\bot}}+\rho_{\mathfrak{a}_{\bot}})-\rho_{\mathfrak{a}_{\bot}}}}{\prod_{\alpha\in\Delta_{\bot}}(1-e^{-\alpha})^{mult(\alpha)}}=\\
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) e^{\rho_{\mathfrak{a}_{\bot}}-\rho} ch L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}
\end{multline}
The projection $\pi_{\mathfrak{a}}$ of the character of the highest-weight module $L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}$ is equal to the dimension of the module multiplied by $e^{\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho_{\mathfrak{a}_{\bot}})}$
  \begin{multline}
    \label{eq:15}
    \pi_{\mathfrak{a}}\left(\sum_{\omega\in W/W_{\bot}} \epsilon(\omega) e^{\rho_{\mathfrak{a}_{\bot}}-\rho} ch L^{\omega(\mu+\rho)-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) = \\
    \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) dim\left(L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) e^{\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho)}
  \end{multline}
These dimensions of the modules could be easily calculated using Weyl formula.

Thus we have the equality
\begin{multline}
  \label{eq:9}
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) dim\left(L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) e^{\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho)}=\\
   \frac{\pi_{\mathfrak{a}}\left(\prod_{\alpha\in \Delta^{+}\setminus \Delta_{\bot}}(1-e^{-\alpha})^{mult_{\mathfrak{g}}(\alpha)} \right)}
   {   \prod_{\beta\in \Delta_{\mathfrak{a}}^{+}}(1-e^{-\beta})^{mult_{\mathfrak{a}}(\beta)}}
\sum_{\lambda \in P_{\frak{a}}}k_{\lambda
}^{\left( \mu \right) }e^{\lambda } 
\end{multline}

We can rewrite the fraction on the right-hand side as in the paper \cite{ilyin812pbc}.
\begin{multline}
  \label{eq:11}
    \frac{\pi_{\mathfrak{a}}\left(\prod_{\alpha\in \Delta^{+}\setminus \Delta_{\bot}}(1-e^{-\alpha})^{mult_{\mathfrak{g}}(\alpha)} \right)}
    {   \prod_{\beta\in \Delta_{\mathfrak{a}}^{+}}(1-e^{-\beta})^{mult_{\mathfrak{a}}(\beta)}}=
    \prod_{\alpha\in \pi_{\mathfrak{a}}\circ (\Delta^{+}\setminus \Delta_{\bot})} \left(1-e^{-\alpha}\right)^{mult(\alpha)-mult_{\mathfrak{a}}(\alpha)}=\\
    = -\sum_{\gamma\in P_{\mathfrak{a}}} s(\gamma)e^{-\gamma}
\end{multline}

For the coefficient function $s\left( \gamma \right) $ define $\Phi _{\frak{a%
}\subset \frak{g}}\subset P_{\frak{a}}$ as its carrier: 
\begin{equation}
\Phi _{\frak{a}\subset \frak{g}}=\left\{ \gamma \in P_{\frak{a}}\mid s\left(
\gamma \right) \neq 0\right\} ;  \label{phi-d}
\end{equation}
\begin{equation}
\prod_{\alpha\in \pi_{\mathfrak{a}}\circ (\Delta^{+}\setminus \Delta_{\bot})}\left(
1-e^{-\alpha }\right) ^{\mathrm{{mult}\left( \alpha \right) -{mult}}_{\frak{a%
}}\mathrm{\left( \alpha \right) }}=-\sum_{\gamma \in \Phi _{\frak{a}\subset 
\frak{g}}}s\left( \gamma \right) e^{-\gamma }.  \label{fan-d}
\end{equation}

So we get the equation
\begin{multline}
  \label{eq:16}
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) dim\left(L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) e^{\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho)}=\\
  = -\sum_{\gamma \in \Phi _{\frak{a}\subset \frak{g}}} s\left( \gamma \right) e^{-\gamma }\sum_{\lambda \in P_{\frak{a}}}
  k_{\lambda }^{\left( \mu \right) }e^{\lambda } \\
  =-\sum_{\gamma \in \Phi _{\frak{a}\subset \frak{g}}}\sum_{\lambda \in P_{\frak{a}}}s\left( \gamma \right) k_{\lambda }^{\left( \mu \right)}e^{\lambda -\gamma }
\end{multline}
From the equality of the coefficients of the equal formal exponents we get
\begin{equation}
  \label{eq:17}
   \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) dim\left(L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) \delta_{\xi,\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho)}+
   \sum_{\gamma \in \Phi _{\frak{a}\subset \frak{g}}} s(\gamma)\; k^{(\mu)}_{\xi+\gamma}=0;\quad \xi\in P_{\mathfrak{a}}
\end{equation}

To get the recurrent relation for the anomalous branching coefficients we should use the following procedure, introduced in the paper \cite{ilyin812pbc}.

Let $\gamma
_{0} $ be the lowest vector with respect to the natural ordering in $%
\overset{\circ }{\Delta _{\frak{a}}}$ in the lowest grade of $\Phi _{\frak{a}\subset \frak{g}}$. Decomposing the defining relation 
\begin{equation}
  \label{eq:18}
  \prod_{\alpha\in \pi_{\mathfrak{a}}\circ (\Delta^{+}\setminus \Delta_{\bot})}\left(
    1-e^{-\alpha }\right) ^{\mathrm{{mult}\left( \alpha \right) -{mult}}_{\frak{a%
      }}\mathrm{\left( \alpha \right) }}=-s\left( \gamma _{0}\right) e^{-\gamma
    _{0}}-\sum_{\gamma \in \Phi _{\frak{a}\subset \frak{g}}\setminus \left\{\gamma_{0}\right\}}s\left( \gamma \right) e^{-\gamma },  
\end{equation}
in (\ref{eq:17}) we obtain

\begin{equation}
k_{\xi }^{\left( \mu \right) }=-\frac{1}{s\left( \gamma _{0}\right) }\left(
  \sum_{\omega\in W/W_{\bot}} \epsilon(\omega) dim\left(L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}\right) \delta_{\xi-\gamma_0,\pi_{\mathfrak{a}}(\omega(\mu+\rho)-\rho)}+
\sum_{\gamma \in
\Gamma _{\frak{a}\subset \frak{g}}}s\left( \gamma +\gamma _{0}\right) k_{\xi
+\gamma }^{\left( \mu \right) }\right)   \label{recurrent relation}
\end{equation}
where the set 
\begin{equation}
\Gamma _{\frak{a}\subset \frak{g}}=\left\{ \xi -\gamma _{0}|\xi \in \Phi _{%
\frak{a}\subset \frak{g}}\right\} \setminus \left\{ 0\right\} .
\label{fan-defined}
\end{equation}

So we've obtained recurrent relation for the anomalous branching coefficients.  In the next section we describe the algorithm for the computation of branching coefficients using the relation \eqref{recurrent relation}. 

\section{Algorithm}
\label{sec:algorithm}
\begin{enumerate}
\item Construct the set of anomalous points of the algebra $\mathfrak{g}$
\item Calculate the dimensions of the corresponding modules $L_{\mathfrak{a}_{\bot}}$.
\item Calculate anomalous branching coefficients in the main Weyl
  chamber of the subalgebra $\mathfrak{a}$ using recurrent relation (\ref{recurrent relation}).
\end{enumerate}

\section{Examples}
\label{sec:examples}

\subsection{Finite dimensional Lie algebras}
\label{sec:finite-dimens-lie}

\subsubsection{Regular embedding of $A_1$ into $B_2$}
\label{sec:regul-embedd-a_1}

Consider the regular embedding of $A_1$ into $B_2$. Simple roots $\alpha_1, \alpha_2$ of $B_2$ are drawn as the thick vectors at the figure \ref{fig:B2_A1}. We denote the corresponding Weyl reflections by $\omega_1, \omega_2$. Simple root $\beta$ of the embedded $A_1$ is equal to $\alpha_1+\alpha_2$.

Let's describe the reduction of fundamental representation of $B_2$ with the highest weight (in fundamental weight basis) equal to $(1,0)$.
\begin{figure}[ph]
  \noindent\centering{
    \includegraphics[width=90mm]{B2_A1.pdf}
  }
  \caption{Regular embedding of $A_1$ into $B_2$}
  \label{fig:B2_A1}
\end{figure}
On the figure \ref{fig:B2_A1} we have also shown the set of points $\omega(\mu+\rho),\; \omega\in W$ of fundamental representation of $B_2$ with the corresponding determinants of Weyl reflections $\epsilon(\omega)$. 
Now we have to factorise the Weyl group $W$ by $W_{\bot}=\left\{\omega_1\right\}$. We get the following set of anomalous points $\omega(\mu+\rho)-\rho,\; \omega\in W/W_{\bot}$:
\begin{figure}[ph]
  \noindent\centering{
    \includegraphics[width=90mm]{B2_A1_2.pdf}
  }
  \caption{Anomalous points and the corresponding $\mathfrak{a}_{\bot}=A_1$-modules}
  \label{fig:B2_A1_2}
\end{figure}
We have also depicted the corresponding $\mathfrak{a}_{\bot}=A_1$-modules $L^{\pi_{\mathfrak{a}_{\bot}}(\omega(\mu+\rho))-\rho_{\mathfrak{a}_{\bot}}}_{\mathfrak{a}_{\bot}}$.
Then we project these points and dimensions of modules onto the root space of subalgebra $\mathfrak{a}=A_1$ and get the following anomalous points in fundamental weights basis with corresponding multiplicities:
\begin{equation}
  \label{eq:1}
  (1,2),\; (0,-3),\; (-4,3),\; (-5,-2)
\end{equation}
For the function $s(\gamma)$ and the set $\Gamma$ from the definition (\ref{phi-d},\ref{fan-defined}) we have
\begin{equation}
  \label{eq:22}
  (0,1),\; (1,2),\; (2,-1)
\end{equation}
Here the second component denotes the value of $s(\gamma)$.

Anomalous branching coefficient $k^{(1,0)}_{1}=2$, then for anomalous branching coefficient $k^{(1,0)}_{0}$ the formula (\ref{recurrent relation}) gives us
\begin{equation}
  \label{eq:23}
  k^{(1,0)}_{0}=-1\cdot k^{(1,0)}_2 +2\cdot k^{(1,0}_1 - 3\cdot \delta_{0,0} = 1
\end{equation}
So we've computed the branching coefficients.
\subsubsection{Embedding of $B_2$ into $B_4$}
\label{sec:someth-high-dimens}
Consider the the regular embedding of the subalgebra $B_2$ into the algebra $B_4$.
We calculate the branching coefficients for the fundamental representation of $B_4$.
The corresponding Dynkin diagrams are in the figure.
\begin{figure}[ph]
  \centering
  \includegraphics[width=60mm]{B4_B2_2A1.pdf}
  \caption{Dynkin diagrams}
  \label{fig:dynkin}
\end{figure}

In the orthogonal basis $e_1,\dots,e_4$ simple roots of $B_4$ are
\begin{equation}
  \label{eq:1}
  (e_1 - e_2,\; e_2 - e_3,\; e_3 - e_4,\; e_4)
\end{equation}
Positive roots are
\begin{multline}
  \label{eq:2}
  (e_1 - e_2,\; e_2 - e_3,\; e_3 - e_4,\; e_4,\; e_1 - e_3,\; e_2 - e_4,\; e_3 + e_4,\; e_3,\; e_1 - e_4,\;\\
    e_2 + e_4,\; e_2,\; e_1 + e_4,\; e_2 + e_3,\; e_1,\; e_1 + e_3,\; e_1 + e_2)
\end{multline}
Simple roots of the embedded subalgebra $\mathfrak{a}=B_2$ are
\begin{equation}
  \label{eq:3}
  (e_3-e_4,e_4)
\end{equation}

The set $\Delta_{\bot}$ is equal to
\begin{equation}
  \label{eq:4}
  \left\{e_1-e_2,e_1+e_2,e_1,e_2\right\}
\end{equation}

We see that this is the set of positive roots of the algebra $\mathfrak{a}_{\bot}=B_2$.

To find the branching coefficients we need to compute the anomalous points of $B_4$, select point lying in the main Weyl chamber of $\mathfrak{a}_{\bot}$ and compute the dimensions of corresponding $\mathfrak{a}_{\bot}$-modules.

We consider the $B_4$-module with the highest weight $\mu=(0,1,0,2)=2
e_1 + 2 e_2 + e_3 + e_4$.

The set of the anomalous points $\omega(\mu+\rho)-\rho,\; \omega\in W$
consists of 384 points. We don't show it here.

We need to select those points $\omega(\mu+\rho)$  which are projected into the main chamber of the embedded algebra $\mathfrak{a}_{\bot}$.
It means that scalar product of these points with all the roots from $\Delta_{\bot}$ is non-negative.

To compute dimensions of the corresponding
$\mathfrak{a}_{\bot}$-modules we need to project each selected point
onto the root space $\Delta_{\bot}$ and substract
$\rho_{\mathfrak{a}_{\bot}}$, then use Weyl dimension formula.

We show the result of this procedure on the figure \ref{fig:B4B2anom}.
\begin{figure}[ph]
    \includegraphics[width=170mm]{B4_B2_anom_points.pdf}
  \caption{Anomalous points with the dimensions of corresponding $\mathfrak{a}_{\bot}$-modules.}
  \label{fig:B4B2anom}
\end{figure}

Then we should construct ``the fan'' and use the recurrent relation for the computation of anomalous branching coefficients.

Using the definition (\ref{fan-defined}) we get the following set of
the points $\Gamma$ with the corresponding values $s(\gamma+\gamma_0)$
\begin{figure}[ph]
  \includegraphics[width=150mm]{B4_B2_fan.pdf}
  \caption{Fan for $B_2\subset B_4$}
  \label{fig:B4B2Fan}
\end{figure}
We use the recurrent relation (\ref{recurrent relation}) and get
following branching coefficients:
\begin{equation}
  \label{eq:24}
  \pi_{\mathfrak{a}} \left(ch L^{(0,1,0,2)}_{B_4}\right) = 6 \; ch L^{(0,0)}_{B_2}+ 60
  \; ch L_{B_2}^{(0,2)}+ 30 \; ch L_{B_2}^{(1,0)}+ 19 \; ch L_{B_2}^{(2,0)}+
  40 \; ch L_{B_2}^{(1,2)}+ 10 \; ch L_{B_2}^{(2,2)}
\end{equation}
The dimension of the highest-weight $B_4$-module $L^{(0,1,0,2)}_{B_4}$
is equal to 2772. It is easy to see, that right-hand side of the
equation (\ref{eq:24}) gives the same result.

\begin{comment}
  Another examples?
\end{comment}
\subsection{Affine Lie algebras}
\label{sec:affine-lie-algebras}
\begin{comment}
  What examples should we include here?
\end{comment}
\subsubsection{Embedding of finite-dimensional algebra into affine algebra}
\label{sec:embedd-finite-dimens}

\subsubsection{Embedding of the affine algebra into affine algebra}
\label{sec:embedd-affine-algebr}

\section{Physical applications}
\label{sec:phys-appl}
\begin{comment}
  Rewrite it in more scientific style or drop this section.
\end{comment}
Branching coefficients for the embedding of affine Lie subalgebra into
affine Lie algebra can be used to construct modular invariant
partition functions of Wess-Zumino-Novikov-Witten models.

 In physically sensible theories holomorphic and antiholomorphic
 sectors should be entangled. It is required for the theory to be
 well-defined on the higher genus Riemann surfaces (see
 \cite{gaberdiel2000icf} and references therein) and also if we want
 our theory to describe critical behavior \cite{difrancesco1997cft}.
 In the critical point theory has conformal invariance, holomorphic
 and antiholomorphic sectors are decoupled, but in the vicinity of
 critical point there exists some large scale so the sectors should
 interact \cite{difrancesco1997cft}, 

The necessary constraint for the theory to be well-defined on higher Riemann surfaces, which is also believed to be sufficient, is that the vacuum correlator on the torus is independent of its parametrisation \cite{gaberdiel2000icf}. Conformal theory on the higher genus Riemann surfaces is important for the string theory since this theory describes string interaction.

Two-dimensional torus is described as quotient space of $\mathbb{R}^2\approx \mathbb{C}$ by the relations $z\sim z+w_1$ and $z\sim z+w_2$, where $w_1$ and $w_2$ are not parallel. 

The complex structure of the torus is conformally equivalent to a torus for which the relations are $z\sim z+1$ and $z\sim z+\tau$ where $\tau$ is in the upper half plane of $\mathbb{C}$. It is also easy to see that $\tau$, $T(\tau)=\tau+1$ and $S(\tau)=-\frac{1}{\tau}$ describe conformally equivalent tori. Two maps $T$ and $S$ generate the group $SL(2,\mathbb{Z})/\mathbb{Z}_2$ that consists of matrices of the form
\begin{equation}
  \label{eq:99}
  A=
  \begin{pmatrix}
    a & b\\
    c & d 
  \end{pmatrix}
  \quad\mbox{where}\; a,b,c,d\in\mathbb{Z},\quad ad-bc=1,
\end{equation}
and matrices $A$ and $-A$ have the same action on $\tau$
\begin{equation}
  \label{eq:100}
  \tau\to A\tau=\frac{a\tau+b}{c\tau+d}
\end{equation}
The parameter $\tau$ is called the modular parameter and the group  $SL(2,\mathbb{Z})/\mathbb{Z}_2$ is called the modular group. 

Given a conformal field theory that is defined on the Riemann sphere, the vacuum
correlator on the torus can be determined as follows. First, we cut the torus along one
of its non-trivial cycles; the resulting surface is a cylinder (or an annulus) whose shape
depends on one complex parameter $q$. Since the annulus is a subset of the sphere, the
conformal field theory on the annulus is determined in terms of the theory on the sphere.
In particular, the states that can propagate in the annulus are precisely the states of
the theory as defined on the sphere.
In order to reobtain the torus from the annulus, we have to glue the two ends of
the annulus together; in terms of conformal field theory this means that we have to sum
over a complete set of states. The vacuum correlator on the torus is therefore described
by a trace over the whole space of states, the partition function of the theory,
\begin{equation}
  \label{eq:101}
  \sum_{(i,j)}Tr_{\mathcal{H}_{(i,j)}}(\mathcal{O}(q,\bar q)),
\end{equation}
where $\mathcal{O}(q,\bar q)$ is the operator that describes the propagation of the states along the annulus,
\begin{equation}
  \label{eq:102}
  \mathcal{O}(q,\bar q)=q^{L_0-\frac{c}{24}}\bar q^{\bar L_0-\frac{\bar c}{24}}
\end{equation}
The propagator depends on the actual shape of the annulus that is described in terms
of the complex parameter $q$. For a given torus that is described by $\tau$ , there is a natural
choice for how to cut the torus into an annulus, and the complex parameter $q$ that is
associated to this annulus is $q=e^{2\pi i \tau}$. Since the tori that are described by $\tau$ and $A\tau$
(where $A \in SL(2, \mathbb{Z})$) are equivalent, the vacuum correlator is only well-defined provided
that (\ref{eq:101}) is invariant under this transformation. This provides strong constraints on
the spectrum of the theory.

Each of the spaces $\mathcal{H}_{(i,j)}$ is a tensor product of an irreducible representation $\mathcal{H}_j$ of chiral algebra and an irreducible representation $\bar{\mathcal{H}}_{\bar{j}}$ of antichiral algebra. Then the vacuum correlator on the torus (\ref{eq:101}) takes the form
\begin{equation}
  \label{eq:103}
  \sum_{(j,\bar j)}\chi_j(q)\bar \chi_{\bar j}(\bar q)
\end{equation}
where $\chi_j$ is the character of the representation $\mathcal{H}_j$,
\begin{equation}
  \label{eq:104}
  \chi_j(\tau)=Tr_{\mathcal{H}_j}(q^{L_0-\frac{c}{24}})\quad \mbox{where}\; q=e^{2\pi i \tau}
\end{equation}
Characters transform into one another under modular transformations,
\begin{equation}
  \label{eq:107}
  \chi_j(-\frac{1}{\tau})=\sum_k S_{jk}\chi_k(\tau)\quad \mbox{and}\quad \chi_j(\tau+1)=\sum_kT_{jk}\chi_k(\tau),
\end{equation}
where $S$ and $T$ are constant matrices. This fact is proved for a certain class of conformal field theories \cite{gaberdiel2000icf}. 

For WZW-models the representations are determined by highest weights $\hat \lambda, \hat \xi$. Then we can write
\begin{equation}
  \label{eq:105}
  \mathcal{H}=\bigoplus_{\hat \lambda,\hat \xi\in P^{(k)}_{+}}M_{\hat \lambda,\hat \xi} L_{\hat \lambda}\otimes L_{\hat \xi}
\end{equation}
The partition function is rewritten as
\begin{equation}
  \label{eq:106}
  Z(\tau)=\sum_{\hat \lambda,\hat \xi\in P^{(k)}_{+}} \chi_{\hat \lambda}(\tau)M_{\hat \lambda\hat\xi}\bar \chi_{\hat \xi}(\bar \tau)
\end{equation}
The element of the mass matrix $M_{\hat \lambda\hat\xi}$ can be thought of as the multiplicity of primary field with weights $\hat\lambda,\hat \xi$. It has following properties:$M_{\hat \lambda\hat\xi}\in \mathbb{Z}_+$, it is modular invariant
\begin{equation}
  \label{eq:108}
  \begin{aligned}
    T^{\dagger}MT=S^{\dagger}MS=M,\\
    [M,S]=[M,T]=0,
  \end{aligned}
\end{equation}
and $M_{00}=1$ for the uniqueness of vacuum. 

The simplest case of diagonal matrix $M$ corresponds to equal holomorphic and antiholomorphic conformal dimensions. There are several ways to construct non-diagonal modular invariants from diagonal \cite{difrancesco1997cft}:
\begin{itemize}
\item Method of outer automorphisms
\item Conformal embedding into bigger theory
\item Galois-transpositions
\end{itemize}
Here we will discuss conformal embeddings.

\subsubsection{Conformal embeddings}
\label{sec:conformal-embeddings}
Conformal embeddings should preserve conformal invariance, so Sugawara central charge should be the same for enveloping and embedded theory. 

The states for the theory that corresponds to the algebra $\mathfrak{g}$
\begin{equation}
  \label{eq:109}
  J^{a_1}_{-n_1}J^{a_2}_{-n_2}\dots\left|\lambda\right>\quad n_1\geq n_2\geq\dots>0
\end{equation}
For sub-algebra $\mathfrak{p}\subset\mathfrak{g}$
\begin{equation}
  \label{eq:110}
  \tilde{J}^{a'_1}_{-n_1}\tilde{J}^{a'_2}_{-n_2}\dots\left|\mathcal{P}\lambda\right>
\end{equation}
Here $\tilde{J}^{a'_j}_{-n_j}$ are the generators of $\mathfrak{p}$ and $\mathcal{P}$ is the projection of $\mathfrak{g}$ to $\mathfrak{p}$. $\mathfrak{g}$-invariance of vacuum entails its $\mathfrak{p}$-invariance, but it is not the case for energy-momentum tensor. So energy-momentum tensor of bigger theory should consist only of generators of $\hat{\mathfrak{p}}$. Then $T_{\hat{\mathfrak{g}}}=T_{\hat{\mathfrak{p}}}\Rightarrow c(\hat{\mathfrak{g}})=c(\hat{\mathfrak{p}})$. This leads to equation
\begin{equation}
  \label{eq:111}
  \frac{k\;dim\mathfrak{g}}{k+g}=\frac{x_e k\; dim\mathfrak{p}}{x_ek+p}
\end{equation}
Here $x_e$ is the embedding index and $g$, $p$ are dual Coxeter numbers of corresponding algebras. !!! Prove and expand !!!

It can be shown that solutions of equation (\ref{eq:111}) exist only
for level 1 $k=1$ \cite{difrancesco1997cft}.

There exist only finite number of such embeddings.

{\bf Examples}
\begin{itemize}
\item $su(2)\subset su(3),\; x_e=4$
\item $\hat{su}(2)_{10}\subset\hat{sp}(4)_1$
\item $\hat{su}(2)_{28}\subset(\hat{G_2})_1$
\item $\hat{su}(2)_{16}\oplus\hat{su}(3)\subset (\hat{E_8})_1$
\end{itemize}

Branching $\hat{\lambda}\to \bigoplus_{\hat{\mu}}b_{\hat{\lambda}\hat{\mu}}\hat{\mu}$
\begin{equation}
  \label{eq:112}
  h_{\hat{\lambda}}+n=h_{\hat{\mu}},\quad \frac{(\lambda,\lambda+2\rho)}{2(1+g)}+n=\frac{(\mu,\mu+2\rho)}{2(x_e+p)}
\end{equation}
The simple way is to calculate the dimensions of all the representations of simple finite-dimensional Lie algebras $\mathfrak{g},\mathfrak{p}$ and find all the triples $(\lambda,\mu,n)$, satisfying (\ref{eq:112}). Then investigate the representation $L_{\hat{\lambda}}$ of level $n$ as the sum of irreducible representations of $\mathfrak{g}$ and write out all the branching rules of these representations in representations of subalgebra $\mathfrak{p}$. The number of times the representation with highest weight $\mu$ appears in this listing is the required branching coefficient $b_{\hat{\lambda},\hat{\mu}}$.

  Then non-diagonal modular invariants are obtained by substitution of character relations. For example, having calculated branching coefficients for $\hat{su}(2)_{28}\subset (\hat{G_2})_1$
  \begin{equation}
    \label{eq:113}
    \begin{aligned}
      & [1,0,0]\to [28,0]\oplus [18,10]\oplus [10,18]\oplus [0,28]\\
      & [0,0,1]\to [22,6]\oplus [16,12]\oplus [12,16]\oplus [6,22]\\
    \end{aligned}
  \end{equation}
we get following modular-invariant partition function
\begin{equation}
  \label{eq:114}
  Z=\left|\chi_{[28,0]}+\chi_{[18,10]}+\chi_{[10,18]}+\chi_{[0,28]}\right|^2+\left|\chi_{[22,6]}+\chi_{[16,12]}+\chi_{[12,16]}+\chi_{[6,22]}\right|^2
\end{equation}

Modular invariants of WZW-models, partition functions etc.

\begin{comment}
  We need some real examples
\end{comment}
\section{Conclusion}
\label{sec:conclusion}
\begin{comment}
  Write it
\end{comment}
\begin{comment}
  What about acknowledgements? 
\end{comment}
\bibliography{article}{}
\bibliographystyle{utphys}

\end{document}
